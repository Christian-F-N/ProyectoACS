MODELADO DE BASE DE DATOS
GESTOR: MYSQL/PHP MY ADMIN
Direccion: Localhost
Usuario: root
Password:

----------------------------------------------------
CREATE DATABASE IF NOT EXISTS proyectomanejo DEFAULT CHARACTER SET utf8 COLLATE utf8_spanish_ci;
USE proyectomanejo;

CREATE TABLE asiento (
  ID_ASI int(5) NOT NULL,
  NUM_ASI varchar(5) COLLATE utf8_spanish_ci NOT NULL,
  UBI_ASI varchar(25) COLLATE utf8_spanish_ci NOT NULL,
  ID_BUS_PER int(5) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE bus (
  ID_BUS int(5) NOT NULL,
  PLA_BUS varchar(10) COLLATE utf8_spanish_ci NOT NULL,
  ANI_BUS int(4) NOT NULL,
  MAR_BUS varchar(20) COLLATE utf8_spanish_ci NOT NULL,
  ID_COP_PER int(5) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE ciudad (
  ID_CIU int(5) NOT NULL,
  NOM_CIU varchar(20) COLLATE utf8_spanish_ci NOT NULL,
  CPS_CIU varchar(10) COLLATE utf8_spanish_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE cliente (
  ID_CLI int(5) NOT NULL,
  CED_CLI varchar(10) COLLATE utf8_spanish_ci NOT NULL,
  NOM_CLI varchar(15) COLLATE utf8_spanish_ci NOT NULL,
  APE_CLI varchar(15) COLLATE utf8_spanish_ci NOT NULL,
  TEL_CLI varchar(15) COLLATE utf8_spanish_ci DEFAULT NULL,
  COR_CLI varchar(20) COLLATE utf8_spanish_ci NOT NULL,
  DIR_CLI varchar(250) COLLATE utf8_spanish_ci DEFAULT NULL,
  PAS_CLI varchar(15) COLLATE utf8_spanish_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE cooperativa (
  ID_COP int(5) NOT NULL,
  NOM_COP varchar(150) COLLATE utf8_spanish_ci NOT NULL,
  RUC_COP varchar(15) COLLATE utf8_spanish_ci NOT NULL,
  DIR_COP varchar(250) COLLATE utf8_spanish_ci NOT NULL,
  TEL_COP varchar(15) COLLATE utf8_spanish_ci NOT NULL,
  COR_COP varchar(50) COLLATE utf8_spanish_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE reserva (
  ID_RES int(5) NOT NULL,
  ID_RUT_RES int(5) NOT NULL,
  ID_CLI_RES int(5) NOT NULL,
  ID_ASI_RES int(5) NOT NULL,
  EST_RES varchar(15) COLLATE utf8_spanish_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE rol (
  ID_ROL int(5) NOT NULL,
  DES_ROL varchar(50) COLLATE utf8_spanish_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE ruta (
  ID_RUT int(5) NOT NULL,
  ID_CIO_RUT int(5) NOT NULL,
  ID_CID_RUT int(5) NOT NULL,
  FHS_RUT datetime NOT NULL,
  FHL_RUT datetime NOT NULL,
  PPJ_RUT decimal(18,2) NOT NULL,
  EST_RUT varchar(15) COLLATE utf8_spanish_ci NOT NULL,
  ID_BUS_RUT int(5) NOT NULL,
  ID_USU_RUT int(5) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;

CREATE TABLE usuario (
  ID_USU int(5) NOT NULL,
  CED_USU varchar(10) COLLATE utf8_spanish_ci NOT NULL,
  NOM_USU varchar(15) COLLATE utf8_spanish_ci NOT NULL,
  APE_USU varchar(15) COLLATE utf8_spanish_ci NOT NULL,
  TEL_USU varchar(15) COLLATE utf8_spanish_ci NOT NULL,
  COR_USU varchar(25) COLLATE utf8_spanish_ci NOT NULL,
  DIR_USU varchar(250) COLLATE utf8_spanish_ci NOT NULL,
  PAS_USU varchar(15) COLLATE utf8_spanish_ci NOT NULL,
  ID_ROL_PER int(5) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;


ALTER TABLE asiento
  ADD PRIMARY KEY (ID_ASI),
  ADD KEY BusAsiento (ID_BUS_PER);

ALTER TABLE bus
  ADD PRIMARY KEY (ID_BUS),
  ADD KEY CooperativaBus (ID_COP_PER);

ALTER TABLE ciudad
  ADD PRIMARY KEY (ID_CIU);

ALTER TABLE cliente
  ADD PRIMARY KEY (ID_CLI);

ALTER TABLE cooperativa
  ADD PRIMARY KEY (ID_COP);

ALTER TABLE reserva
  ADD PRIMARY KEY (ID_RES),
  ADD KEY RutaReserva (ID_RUT_RES),
  ADD KEY ClienteReserva (ID_CLI_RES),
  ADD KEY AsientoReserva (ID_ASI_RES);

ALTER TABLE rol
  ADD PRIMARY KEY (ID_ROL);

ALTER TABLE ruta
  ADD PRIMARY KEY (ID_RUT),
  ADD KEY CiudadRutaO (ID_CIO_RUT),
  ADD KEY CiudadRutaD (ID_CID_RUT),
  ADD KEY BusRuta (ID_BUS_RUT),
  ADD KEY UsuarioRuta (ID_USU_RUT);

ALTER TABLE usuario
  ADD PRIMARY KEY (ID_USU),
  ADD KEY RolUusario (ID_ROL_PER);


ALTER TABLE asiento
  MODIFY ID_ASI int(5) NOT NULL AUTO_INCREMENT;

ALTER TABLE bus
  MODIFY ID_BUS int(5) NOT NULL AUTO_INCREMENT;

ALTER TABLE ciudad
  MODIFY ID_CIU int(5) NOT NULL AUTO_INCREMENT;

ALTER TABLE cliente
  MODIFY ID_CLI int(5) NOT NULL AUTO_INCREMENT;

ALTER TABLE cooperativa
  MODIFY ID_COP int(5) NOT NULL AUTO_INCREMENT;

ALTER TABLE reserva
  MODIFY ID_RES int(5) NOT NULL AUTO_INCREMENT;

ALTER TABLE rol
  MODIFY ID_ROL int(5) NOT NULL AUTO_INCREMENT;

ALTER TABLE ruta
  MODIFY ID_RUT int(5) NOT NULL AUTO_INCREMENT;

ALTER TABLE usuario
  MODIFY ID_USU int(5) NOT NULL AUTO_INCREMENT;


ALTER TABLE asiento
  ADD CONSTRAINT BusAsiento FOREIGN KEY (ID_BUS_PER) REFERENCES bus (ID_BUS) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE bus
  ADD CONSTRAINT CooperativaBus FOREIGN KEY (ID_COP_PER) REFERENCES cooperativa (ID_COP) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE reserva
  ADD CONSTRAINT AsientoReserva FOREIGN KEY (ID_ASI_RES) REFERENCES asiento (ID_ASI) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT ClienteReserva FOREIGN KEY (ID_CLI_RES) REFERENCES cliente (ID_CLI) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT RutaReserva FOREIGN KEY (ID_RUT_RES) REFERENCES ruta (ID_RUT) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE ruta
  ADD CONSTRAINT BusRuta FOREIGN KEY (ID_BUS_RUT) REFERENCES bus (ID_BUS) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT CiudadRutaD FOREIGN KEY (ID_CID_RUT) REFERENCES ciudad (ID_CIU) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT CiudadRutaO FOREIGN KEY (ID_CIO_RUT) REFERENCES ciudad (ID_CIU) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT UsuarioRuta FOREIGN KEY (ID_USU_RUT) REFERENCES usuario (ID_USU) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE usuario
  ADD CONSTRAINT RolUusario FOREIGN KEY (ID_ROL_PER) REFERENCES rol (ID_ROL) ON DELETE NO ACTION ON UPDATE NO ACTION;
COMMIT;